<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Measuring different epidermal morphologies with epidermalmorph • epidermalmorph</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Measuring different epidermal morphologies with epidermalmorph">
<meta property="og:description" content="epidermalmorph">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epidermalmorph</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-to-epidermalmorph.html">Introduction to epidermalmorph</a>
    </li>
    <li>
      <a href="../articles/measuring-different-morphologies.html">Measuring different epidermal morphologies with epidermalmorph</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Measuring different epidermal morphologies with
epidermalmorph</h1>
                        <h4 data-toc-skip class="author">Matilda
Brown</h4>
            
      
      
      <div class="hidden name"><code>measuring-different-morphologies.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidermalmorph</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra" class="external-link">factoextra</a></span><span class="op">)</span></span></code></pre></div>
<p>In ‘Introduction to epidermalmorph’, we looked at a workflow for one
group of plants, with a specific type of stomatal morphology: subsidiary
cells arranged on either side of the guard cells, with stomata aligned
in rows and traced as single cells (both guard cells and the pore
forming the same polygon). However, <code>epidermalmorph</code> can be
used to extract epidermal traits from a wide range of different plants -
this is what we will do here.</p>
<p>Let’s start by looking at our example images; we are going to look at
5 species of plant with 1-3 images per species; these images are all
available in the Supporting Information of: Vőfély, R. V., Gallagher,
J., Pisano, G. D., Bartlett, M., &amp; Braybrook, S. A. (2019). <em>Of
puzzles and pavements: a quantitative exploration of leaf epidermal cell
shape</em>. New Phytologist, <strong>221</strong>(1), 540-552.</p>
<p><img src="All_spp.png"></p>
<p>Some of these species have subsidiary cells, some have randomly
aligned stomata and one (Ceratostigma) has salt glands, clustered in
groups of four. What does this mean for using
<code>epidermalmorph</code>?</p>
<p>Let’s go through species by species, but first we’ll set up somewhere
for our extracted trait data to live:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="st">"images"</span></span></code></pre></div>
<div class="section level3">
<h3 id="kniphofia-caulescens-and-hemerocallis-fulva">
<em>Kniphofia caulescens</em> and <em>Hemerocallis fulva</em><a class="anchor" aria-label="anchor" href="#kniphofia-caulescens-and-hemerocallis-fulva"></a>
</h3>
<p>In these two species, there are no subsidiary cells, so
<code>stom.symmetry.mean</code> and <code>stom.butterfly.mean</code>
don’t make any sense - we’ll exclude them using the
<code>specific.exclusions</code> argument. Guard cells have been traced
as pairs (two cells rather than one), so we’ll set
<code>paired.guard.cells</code> to <code>TRUE</code>.</p>
<p>Note: this document suppresses the messages generated by
<code>extract_epidermal_traits</code>, but an example is shown for
<em>Ceratostigma</em> below.</p>
<p><img src="K_and_H_all.png"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kniphofia_1.tif"</span>,<span class="st">"Kniphofia_2.tif"</span>,<span class="st">"Kniphofia_3.tif"</span>,</span>
<span>           <span class="st">"Hemerocallis_1.tif"</span>,<span class="st">"Hemerocallis_2.tif"</span>,<span class="st">"Hemerocallis_3.tif"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="co">#drop the .tif for the image ID</span></span>
<span></span>
<span><span class="co">#append these results to the growing list of results</span></span>
<span><span class="va">traits</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span></span>
<span>  image.ID <span class="op">=</span> <span class="va">id</span>,</span>
<span>  cell.polygons <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>  junction.points <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">junction_coords</span>,</span>
<span>  cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>,<span class="st">"stomata"</span><span class="op">)</span>,</span>
<span>  cell.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span><span class="op">)</span>,</span>
<span>  paired.guard.cells <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#just to reduce the number of traits</span></span>
<span>  specific.exclusions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"symmetry"</span>, <span class="st">"butterfly"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="valeriana-officinalis">
<em>Valeriana officinalis</em><a class="anchor" aria-label="anchor" href="#valeriana-officinalis"></a>
</h3>
<p>In this species, there are no subsidiary cells, so
<code>stom.symmetry.mean</code> and <code>stom.butterfly.mean</code>
don’t make any sense - we’ll exclude them using the
<code>specific.exclusions</code> argument. The stomata are randomly
oriented, so we’ll set <code>stomatal.north</code> to 0. They are also
in pairs (two cells rather than one), so we’ll set
<code>paired.guard.cells</code> to <code>TRUE</code>.</p>
<p><img src="Valeriana_all.png"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Valeriana_1.tif"</span>,<span class="st">"Valeriana_2.tif"</span>,<span class="st">"Valeriana_3.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span><span class="va">dir</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="co">#drop the .tif for the image ID</span></span>
<span></span>
<span><span class="va">traits</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span></span>
<span>  image.ID <span class="op">=</span> <span class="va">id</span>,</span>
<span>  cell.polygons <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>  junction.points <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">junction_coords</span>,</span>
<span>  cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>,<span class="st">"stomata"</span><span class="op">)</span>,</span>
<span>  cell.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span><span class="op">)</span>,</span>
<span>  paired.guard.cells <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stomatal.north <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#to reduce the number of traits</span></span>
<span>  specific.exclusions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"symmetry"</span>,<span class="st">"butterfly"</span>,<span class="st">"endwall"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ceratostigma-plumbaginoides">
<em>Ceratostigma plumbaginoides</em><a class="anchor" aria-label="anchor" href="#ceratostigma-plumbaginoides"></a>
</h3>
<p>In this species, there are subsidiary cells, but they form an
encircling ring, so <code>stom.symmetry.mean</code> and
<code>stom.butterfly.mean</code> don’t make any sense here either -
we’ll exclude them again using the <code>specific.exclusions</code>
argument.</p>
<p><img src="Ceratostigma_all.png"></p>
<p>Again, the stomata are randomly oriented, so we’ll set
<code>stomatal.north</code> to 0. They are also in pairs (two cells
rather than one), so we’ll keep <code>paired.guard.cells</code> set to
<code>TRUE</code>. There is also another type of cell - the salt glands.
First, let’s see what happens when we ignore it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ceratostigma_1.tif"</span>,<span class="st">"Ceratostigma_2.tif"</span>,<span class="st">"Ceratostigma_3.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#just the first one as a test</span></span>
<span>  </span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span><span class="va">dir</span>,<span class="va">files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="co">#drop the .tif for the image ID</span></span>
<span></span>
<span><span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span></span>
<span>  image.ID <span class="op">=</span> <span class="va">id</span>,</span>
<span>  cell.polygons <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>  junction.points <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">junction_coords</span>,</span>
<span>  cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>,<span class="st">"stomata"</span>,<span class="st">"subsidiary"</span><span class="op">)</span>,</span>
<span>  cell.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span>,<span class="fl">170</span><span class="op">)</span>,</span>
<span>  paired.guard.cells <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stomatal.north <span class="op">=</span> <span class="fl">0</span>,   </span>
<span>  sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># to reduce the number of traits</span></span>
<span>  specific.exclusions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"symmetry"</span>,<span class="st">"butterfly"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="message.PNG"> The salt glands still get measured (as
<code>othertype1</code>), but it would be nice to specify a name, so
here we’ve added them to the <code>cells.present</code> and
<code>cell.values</code> arguments. We also get a warning about endwall
angles not being reliable, so we’ll exclude anything to do with endwalls
using the <code>specific.exclsions</code> argument - we can use a
keyword rather than the full trait names.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span><span class="va">dir</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="co">#drop the .tif for the image ID</span></span>
<span></span>
<span><span class="va">traits</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span></span>
<span>  image.ID <span class="op">=</span> <span class="va">id</span>,</span>
<span>  cell.polygons <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>  junction.points <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">junction_coords</span>,</span>
<span>  cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>,<span class="st">"stomata"</span>,<span class="st">"subsidiary"</span>,<span class="st">"saltgland"</span><span class="op">)</span>,</span>
<span>  cell.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span>,<span class="fl">170</span>,<span class="fl">50</span><span class="op">)</span>,</span>
<span>  paired.guard.cells <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stomatal.north <span class="op">=</span> <span class="fl">0</span>,   </span>
<span>  sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#just to reduce the number of traits</span></span>
<span>  specific.exclusions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"symmetry"</span>,<span class="st">"butterfly"</span>,<span class="st">"endwall"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="lygodium-microphyllum">
<em>Lygodium microphyllum</em><a class="anchor" aria-label="anchor" href="#lygodium-microphyllum"></a>
</h2>
<p>One last example, because in this one the image has been taken with
the stomata aligned vertically, so we need to set
<code>image.alignment</code> to “vertical” (the default is “horizontal”,
but we can also set “none”). The raw image is also quite different to
the others, but the tracing follows the same principles.</p>
<p><img src="Lygodium_all.png"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lygodium_1.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">files</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">files</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="co">#drop the .tif for the image ID</span></span>
<span></span>
<span><span class="va">traits</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span></span>
<span>  image.ID <span class="op">=</span> <span class="va">id</span>,</span>
<span>  cell.polygons <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>  junction.points <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">junction_coords</span>,</span>
<span>  cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>,<span class="st">"stomata"</span><span class="op">)</span>,</span>
<span>  cell.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span><span class="op">)</span>,</span>
<span>  paired.guard.cells <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  image.alignment <span class="op">=</span> <span class="st">"vertical"</span> ,</span>
<span>  sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#just to reduce the number of traits</span></span>
<span>  specific.exclusions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"symmetry"</span>,<span class="st">"butterfly"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can compare these species, but there are two things we have to
be careful of. 1. Not all species have all traits measured 2. The scale
for these images is not consistent - we could have passed the scales
individually using <code>image.scale</code> but several of the extracted
traits are ratios and this scale-independent, so we can actually still
compare them even if we do not know the scale of each image. These
scale-independent traits include: index traits (e.g. stomatal index),
complexity traits (e.g. pavezone cell complexity), aspect ratio and
traits (e.g. stomatal complex aspect ratio), number of junction points,
endwall angles, stomatal symmetry, and the stomatal butterfly metric
(ratio of guard cell to lateral subsidiary cell lengths).</p>
<p>Let’s bind all our extracted traits into a dataset and select only
those traits that are scale-independent AND were measured for all
images:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traits_all</span> <span class="op">&lt;-</span> <span class="va">traits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">image_data</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">traits_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">traits_all</span>, <span class="va">traits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">image_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#select only the scale-independent traits (ratios) using the trait key </span></span>
<span><span class="va">scale_independent_traits</span> <span class="op">&lt;-</span> <span class="va">trait_key</span><span class="op">$</span><span class="va">trait</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trait_key</span><span class="op">$</span><span class="va">scaledependent</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">traits_scaleind</span> <span class="op">&lt;-</span> <span class="va">traits_all</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">traits_all</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">scale_independent_traits</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">traits_nona</span> <span class="op">&lt;-</span> <span class="va">traits_scaleind</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">traits_scaleind</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co">#add genus using the underscore as a way of splitting the IDs</span></span>
<span><span class="va">traits_nona</span><span class="op">$</span><span class="va">genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">traits_nona</span><span class="op">$</span><span class="va">image.ID</span>, <span class="st">"_"</span><span class="op">)</span>,<span class="st">"[["</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#plot two of these</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">traits_nona</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pavezone.complexity.median</span>,</span>
<span>                       y<span class="op">=</span><span class="va">stom.AR.mean</span>,</span>
<span>                       colour<span class="op">=</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="measuring-different-morphologies_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We might then do a PCA or an LDA to reduce the dimensionality and
visualise our trait-space - this is where this example finishes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traits_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">traits_nona</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">traits_pca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Importance of components:</span></span>
<span><span class="co">##                           PC1    PC2    PC3     PC4     PC5     PC6     PC7</span></span>
<span><span class="co">## Standard deviation     2.3243 1.6997 1.4457 1.00774 0.61103 0.35023 0.20469</span></span>
<span><span class="co">## Proportion of Variance 0.4502 0.2407 0.1742 0.08463 0.03111 0.01022 0.00349</span></span>
<span><span class="co">## Cumulative Proportion  0.4502 0.6909 0.8651 0.94974 0.98085 0.99108 0.99457</span></span>
<span><span class="co">##                           PC8    PC9    PC10    PC11    PC12</span></span>
<span><span class="co">## Standard deviation     0.1960 0.1387 0.07624 0.03925 0.01432</span></span>
<span><span class="co">## Proportion of Variance 0.0032 0.0016 0.00048 0.00013 0.00002</span></span>
<span><span class="co">## Cumulative Proportion  0.9978 0.9994 0.99985 0.99998 1.00000</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#basic visualisation</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html" class="external-link">fviz_pca_ind</a></span><span class="op">(</span><span class="va">traits_pca</span>, habillage<span class="op">=</span><span class="va">traits_nona</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span></code></pre></div>
<p><img src="measuring-different-morphologies_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html" class="external-link">fviz_pca_var</a></span><span class="op">(</span><span class="va">traits_pca</span><span class="op">)</span></span></code></pre></div>
<p><img src="measuring-different-morphologies_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matilda Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
