<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to epidermalmorph • epidermalmorph</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to epidermalmorph">
<meta property="og:description" content="epidermalmorph">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epidermalmorph</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-to-epidermalmorph.html">Introduction to epidermalmorph</a>
    </li>
    <li>
      <a href="../articles/measuring-different-morphologies.html">Measuring different epidermal morphologies with epidermalmorph</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to epidermalmorph</h1>
            
      
      
      <div class="hidden name"><code>introduction-to-epidermalmorph.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidermalmorph</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dahtah.github.io/imager/" class="external-link">imager</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">randomcoloR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="input-for-epidermalmorph">Input for <code>epidermalmorph</code><a class="anchor" aria-label="anchor" href="#input-for-epidermalmorph"></a>
</h2>
<p>Here is an example of an unprocessed (raw) image of a cuticle
preparation cuticle of <em>Podocarpus</em>, taken using a
microscope:</p>
<center>
<img src="raw_im.png" style="width:60.0%">
</center>
<p>For analysis with <code>epidermalmorph</code>, images need to be
segmented (or traced). This can be done manually (e.g. using the paint
tool from ImageJ, MS Paint) or with some degree of automation, but
requires cell wall pixels to be black (value of 0) and <strong>no
anti-aliasing</strong> to be applied (i.e., the edges of the pixels
should be crisp). Other cell types can be labelled by using different
values (colours). Here is what that might look like:</p>
<center>
<img src="traced_im.png" style="width:60.0%">
</center>
<p>Our cell walls are black (value of 0), stomata are dark grey (85),
subsidiary cells are light grey (170) and pavement cells are white
(255).</p>
</div>
<div class="section level2">
<h2 id="extracting-cell-measurements">Extracting cell measurements<a class="anchor" aria-label="anchor" href="#extracting-cell-measurements"></a>
</h2>
<div class="section level3">
<h3 id="the-image_to_poly-function">The <code>image_to_poly()</code> function<a class="anchor" aria-label="anchor" href="#the-image_to_poly-function"></a>
</h3>
<p>Before we can measure cells, they need to be transformed from pixels
to polygons:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polys1.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/image_to_poly.html">image_to_poly</a></span><span class="op">(</span>dir<span class="op">=</span><span class="st">'images'</span>, file<span class="op">=</span><span class="st">"traced_im.png"</span><span class="op">)</span></span></code></pre></div>
<p>This gives us a list, with an object called <code>cells</code> (our
polygons) and an object called <code>junction_points</code> (used for
cell quantification). We can confirm that this has worked by plotting
our polygons with a unique colour for each cell:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#generate as many random colours as there are cells</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">cells</span><span class="op">)</span></span>
<span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomcoloR/man/distinctColorPalette.html" class="external-link">distinctColorPalette</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">cells</span>, col<span class="op">=</span><span class="st">"black"</span>, fill<span class="op">=</span><span class="va">palette</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-epidermalmorph_files/figure-html/unnamed-chunk-5-1.png" width="672">
We can also check that the cell types (as values) have been preserved
during the conversion from pixels to polygons:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#simplify palette to cell types</span></span>
<span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#A30B37"</span>, <span class="st">"#bd6b73"</span>, <span class="st">"#bbb6df"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">cells</span>, col<span class="op">=</span><span class="st">"black"</span>, fill<span class="op">=</span><span class="va">palette</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">cells</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-epidermalmorph_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="trait-extraction">Trait extraction<a class="anchor" aria-label="anchor" href="#trait-extraction"></a>
</h3>
<p>The stomatal complexes are in red (lighter red shows the subsidiary
cells). Now we can extract the measurements from it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">traits1.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span>image.ID <span class="op">=</span> <span class="st">"Image1.1"</span>, </span>
<span>                                      cell.polygons<span class="op">=</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">cells</span>, </span>
<span>                                      junction.points<span class="op">=</span><span class="va">polys1.1</span><span class="op">$</span><span class="va">junction_coords</span>, </span>
<span>                                      cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>, <span class="st">"stomata"</span>,<span class="st">"subsidiary"</span><span class="op">)</span>, </span>
<span>                                      wall.width <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                      cell.values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span>, <span class="fl">170</span><span class="op">)</span>, </span>
<span>                                      sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#no variability traits</span></span>
<span>                                      image.scale <span class="op">=</span> <span class="cn">NULL</span>,  verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#this can take up to around 10 minutes per image</span></span></code></pre></div>
<p><code>extract_epidermal_traits</code> returns a list:</p>
<ul>
<li>
<code>image_data</code> the measured traits, summarised to give one
value per image</li>
<li>
<code>pavezone_individual_data</code> measurements for individual
pavement zone cells (not adjacent to a stomatal complex)</li>
<li>
<code>stomzone_individual_data</code> measurements for individual
stomatal zone cells (adjacent to a stomatal complex)</li>
<li>
<code>polar_individual_data</code> measurements for individual polar
subsidiary cells (those that share a cell wall with the guard
cells/stomatal pore, regardless of whether or not they are considered
‘true’ subsidiary cells)</li>
<li>
<code>stomata_individual_data</code> measurements for individual
stomatal complex</li>
<li>
<code>polygons</code> the <code>sf</code> polygons of the cells
(removed here to reduce vignette size)</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">traits1.1</span><span class="op">$</span><span class="va">image_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 39</span></span>
<span><span class="co">#&gt; $ image.ID                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Image1.1"</span></span>
<span><span class="co">#&gt; $ rotation                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.079451</span></span>
<span><span class="co">#&gt; $ n.pavement                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 340</span></span>
<span><span class="co">#&gt; $ n.stomata                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 30</span></span>
<span><span class="co">#&gt; $ n.subsidiary                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 74</span></span>
<span><span class="co">#&gt; $ stomatal.density               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4.970346e-05</span></span>
<span><span class="co">#&gt; $ stomatal.index                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.326531</span></span>
<span><span class="co">#&gt; $ dist.between.stom.rows         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 236.586</span></span>
<span><span class="co">#&gt; $ row.consistency                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ row.wiggliness                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.477667</span></span>
<span><span class="co">#&gt; $ stom.angle.sd                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1616541</span></span>
<span><span class="co">#&gt; $ stom.distNN.mean               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 54.90197</span></span>
<span><span class="co">#&gt; $ stom.dist2NN.mean              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 94.43844</span></span>
<span><span class="co">#&gt; $ stom.spacingNN.mean            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.636364</span></span>
<span><span class="co">#&gt; $ stom.nsubcells.mean            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.451613</span></span>
<span><span class="co">#&gt; $ stom.subsarea.mean             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1052.247</span></span>
<span><span class="co">#&gt; $ stom.gclength.mean             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 23.56796</span></span>
<span><span class="co">#&gt; $ stom.AR.mean                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.071619</span></span>
<span><span class="co">#&gt; $ stom.butterfly.mean            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5159461</span></span>
<span><span class="co">#&gt; $ stom.symmetry.mean             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.7357696</span></span>
<span><span class="co">#&gt; $ pavezone.angle.median          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.05213068</span></span>
<span><span class="co">#&gt; $ pavezone.AR.median             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.110892</span></span>
<span><span class="co">#&gt; $ pavezone.area.median           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1427.611</span></span>
<span><span class="co">#&gt; $ pavezone.complexity.median     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.082962</span></span>
<span><span class="co">#&gt; $ pavezone.endwallangle.mean     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.497578</span></span>
<span><span class="co">#&gt; $ pavezone.endwalldiff.mean      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.302275</span></span>
<span><span class="co">#&gt; $ pavezone.njunctionpts.mean     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.025316</span></span>
<span><span class="co">#&gt; $ pavezone.undulation.amp.median <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5.306078</span></span>
<span><span class="co">#&gt; $ pavezone.undulation.freq.mean  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1550792</span></span>
<span><span class="co">#&gt; $ stomzone.AR.median             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.715364</span></span>
<span><span class="co">#&gt; $ stomzone.area.median           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1168.332</span></span>
<span><span class="co">#&gt; $ stomzone.complexity.median     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.092794</span></span>
<span><span class="co">#&gt; $ stomzone.undulation.amp.median <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.878516</span></span>
<span><span class="co">#&gt; $ stomzone.undulation.freq.mean  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1594227</span></span>
<span><span class="co">#&gt; $ polar.AR.median                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.293851</span></span>
<span><span class="co">#&gt; $ polar.area.median              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 562.736</span></span>
<span><span class="co">#&gt; $ polar.complexity.median        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.06181</span></span>
<span><span class="co">#&gt; $ polar.undulation.amp.median    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.906912</span></span>
<span><span class="co">#&gt; $ polar.undulation.freq.mean     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3144654</span></span></code></pre></div>
<p>For a full description of all traits, we can refer to
<code>trait_key</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trait_key</span><span class="op">)</span></span>
<span><span class="co">#&gt;          trait   celltype category sd scaledependent</span></span>
<span><span class="co">#&gt; 1     image.ID               basic  0              0</span></span>
<span><span class="co">#&gt; 2     rotation               basic  0              0</span></span>
<span><span class="co">#&gt; 3   n.pavement              number  0              1</span></span>
<span><span class="co">#&gt; 4    n.stomata    stomata   number  0              1</span></span>
<span><span class="co">#&gt; 5 n.subsidiary subsidiary   number  0              1</span></span>
<span><span class="co">#&gt; 6      n.other      other   number  0              1</span></span>
<span><span class="co">#&gt;                                                           description</span></span>
<span><span class="co">#&gt; 1                                                Identifier for image</span></span>
<span><span class="co">#&gt; 2 Rotation of image, either stomatal north or the user input rotation</span></span>
<span><span class="co">#&gt; 3                                            Number of pavement cells</span></span>
<span><span class="co">#&gt; 4                                                   Number of stomata</span></span>
<span><span class="co">#&gt; 5                                          Number of subsidiary cells</span></span>
<span><span class="co">#&gt; 6                                               Number of other cells</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="which-traits-can-we-reliably-quantify-for-a-particular-group-of-plants">Which traits can we reliably quantify for a particular group of
plants?<a class="anchor" aria-label="anchor" href="#which-traits-can-we-reliably-quantify-for-a-particular-group-of-plants"></a>
</h2>
<p>In this vignette, we will use nine pre-traced images (three images
per plant, from three plants in the Podocarpaceae) to demonstrate a
possible workflow for <code>epidermalmorph</code>. These cells are from
<em>Acmopyle pancheri</em> (top row), <em>Podocarpus dispermus</em>
(middle row) and <em>Sundacarpus amarus</em> (labeled as <em>Prumnopitys
amara</em>; bottom row). Note that for a family-level study, three
plants would not be sufficient to accurately assess prediction
(<em>see</em> Brown, 2022)</p>
<p>The epidermal cells of these three plants are clearly distinguishable
from each other:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"polys.Rdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#A30B37"</span>, <span class="st">"#bd6b73"</span>, <span class="st">"#bbb6df"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">p</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cells</span>, col<span class="op">=</span><span class="st">"black"</span>, fill<span class="op">=</span><span class="va">palette</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cells</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">p</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="p3.png" style="width:100.0%"></p>
<p>Now we can extract the traits. There is no parallel implementation in
<code>epidermalmorph</code>, but we suggest extracting traits from
multiple images in parallel, like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#names for ID column - the file names of the images</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acmopyle_pancheri_1.tif"</span>,</span>
<span>           <span class="st">"Acmopyle_pancheri_2.tif"</span>,</span>
<span>           <span class="st">"Acmopyle_pancheri_1_3.tif"</span>,</span>
<span>           <span class="st">"Podocarpus_dispermus_1.tif"</span>,</span>
<span>           <span class="st">"Podocarpus_dispermus_2.tif"</span>,</span>
<span>           <span class="st">"Podocarpus_dispermus_3.tif"</span>,</span>
<span>           <span class="st">"Sundacarpus_amarus_1.tif"</span>,</span>
<span>           <span class="st">"Sundacarpus_amarus_2.tif"</span>,</span>
<span>           <span class="st">"Sundacarpus_amarus_3.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, .packages <span class="op">=</span> <span class="st">"epidermalmorph"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span><span class="fu"><a href="../reference/extract_epidermal_traits.html">extract_epidermal_traits</a></span><span class="op">(</span>image.ID <span class="op">=</span> <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>                         cell.polygons <span class="op">=</span> <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                         junction.points <span class="op">=</span> <span class="va">polys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                         cells.present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pavement"</span>, <span class="st">"stomata"</span>, </span>
<span>                                           <span class="st">"subsidiary"</span><span class="op">)</span>, </span>
<span>                         sd.measures <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#no variability traits</span></span>
<span>                         cell.values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>,<span class="fl">85</span>,<span class="fl">170</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>For now, we just want to compare the overall measurements, so we’ll
bind the first element of each list together, and scale our trait
measurements so that they can be be compared (we’re saving the global
standard deviations to be used later):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_im</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_all</span>,<span class="st">"[["</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">globalSDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">df_im</span><span class="op">[</span>,<span class="fl">10</span><span class="op">:</span><span class="fl">39</span><span class="op">]</span><span class="op">)</span>,<span class="st">"scaled:scale"</span><span class="op">)</span> <span class="co">#used later in this vignette</span></span>
<span></span>
<span><span class="va">df_im</span> <span class="op">&lt;-</span> <span class="va">df_im</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">stomatal.density</span><span class="op">:</span><span class="va">polar.undulation.freq.mean</span>,   <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">df_im</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="co">#only show first 10 columns for brevity</span></span>
<span><span class="co">#&gt; Rows: 9</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; $ image.ID               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Acmopyle_pancheri_1_1.tif", "Acmopyle_pancheri…</span></span>
<span><span class="co">#&gt; $ rotation               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -1.6433946, -5.6864687, 0.4205948, -1.2037529, …</span></span>
<span><span class="co">#&gt; $ n.pavement             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 586, 577, 485, 359, 357, 352, 260, 246, 268</span></span>
<span><span class="co">#&gt; $ n.stomata              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 120, 116, 96, 31, 30, 31, 36, 30, 36</span></span>
<span><span class="co">#&gt; $ n.subsidiary           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 259, 286, 205, 67, 67, 67, 76, 64, 73</span></span>
<span><span class="co">#&gt; $ stomatal.density       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.6138089, 1.3029417, 1.0369279, -0.6485418, -0…</span></span>
<span><span class="co">#&gt; $ stomatal.index         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.33648596, 1.08367330, 1.26368431, -1.04454500…</span></span>
<span><span class="co">#&gt; $ dist.between.stom.rows <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.9696199, -1.2562436, -0.9510668, 1.3375655, …</span></span>
<span><span class="co">#&gt; $ row.consistency        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.06181364, 1.35092871, 0.74826970, 0.69230347,…</span></span>
<span><span class="co">#&gt; $ row.wiggliness         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.16892056, 1.89337838, 0.30717709, -0.2887358…</span></span></code></pre></div>
<p>This data is only identified by the image filename - we need to add
the image metadata (here, with species and individual information)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"example_metadata.csv"</span>, fileEncoding <span class="op">=</span> <span class="st">'UTF-8-BOM'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">df_meta</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 9</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ image.ID   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Acmopyle_pancheri_1_1.tif", "Acmopyle_pancheri_1_2.tif", "…</span></span>
<span><span class="co">#&gt; $ Genus      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Acmopyle", "Acmopyle", "Acmopyle", "Podocarpus", "Podocarp…</span></span>
<span><span class="co">#&gt; $ species    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "pancheri", "pancheri", "pancheri", "dispermus", "dispermus…</span></span>
<span><span class="co">#&gt; $ taxon      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Acmopyle_pancheri", "Acmopyle_pancheri", "Acmopyle_pancher…</span></span>
<span><span class="co">#&gt; $ individual <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Acmopyle_pancheri1", "Acmopyle_pancheri1", "Acmopyle_panch…</span></span>
<span></span>
<span><span class="va">df_im</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_meta</span>, <span class="va">df_im</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Joining, by = "image.ID"</span></span></code></pre></div>
<p>Now we can look at how much intra-individual variation there is in
each of our measured traits.</p>
<p>One way we can visualise this is by plotting each measurement for
each individual, where larger ranges (wider bars) indicate less
intra-individual variation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_im_long</span> <span class="op">&lt;-</span> <span class="va">df_im</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">43</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_im_long</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>, y<span class="op">=</span><span class="va">value</span>, group<span class="op">=</span><span class="va">individual</span>, col<span class="op">=</span><span class="va">individual</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>, y<span class="op">=</span><span class="va">value</span>, group<span class="op">=</span><span class="va">name</span>, col<span class="op">=</span><span class="va">individual</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">individual</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/theme_pubr.html" class="external-link">theme_pubclean</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,legend.direction<span class="op">=</span><span class="st">"vertical"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-epidermalmorph_files/figure-html/unnamed-chunk-17-1.png" width="672">
This is an intuitive way to look at trait reliability, but gets out of
hand quickly when considering a larger set of individuals/species.</p>
<p><code>epidermalmorph</code> includes the
<code>epidermal_trait_reliability</code> function, which produces a list
of two objects:</p>
<ul>
<li>a data.frame with the reliability estimates</li>
<li>a ggplot heatmap visualisation of this information, where the colour
of the tile represents the width of the corresponding line in the above
plot</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reliability</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidermal_trait_reliability.html">epidermal_trait_reliability</a></span><span class="op">(</span><span class="va">df_im</span>, </span>
<span>                                              grouping.variable<span class="op">=</span><span class="st">"individual"</span>, </span>
<span>                                              heatmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reliability</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="introduction-to-epidermalmorph_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>From this, it is easier to see that <em>Podocarpus dispermus</em>
tends to be more consistent across images, and if we define a reliable
trait as one that has a within-individual variation of no more than 25%
of the total variation (i.e. <code>thresholdval = 0.25</code>), we can
identify four traits that can be reliably measured from an image of each
of these plants: stomzone.area.median, stomatal.index,
stomzone.undulation.amp.median, pavezone.undulation.amp.median</p>
<p>Note that for this set of podocarps, stomatal index is one of the
most reliable traits that can be measured from an image - this is not
the case when analysing a wider set of plants (Brown, 2022),
highlighting the need to calibrate these measurements carefully to the
study system and select a <strong>representative subset</strong> of this
group to evaluate reliability.</p>
<p>We can extract these traits automatically using the data.frame that
is returned by <code><a href="../reference/epidermal_trait_reliability.html">epidermal_trait_reliability()</a></code> - here is one
example of how that could be done:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reliable_traits</span> <span class="op">&lt;-</span> <span class="va">df_reliability</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>maxvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">variation</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">maxvar</span><span class="op">&lt;</span><span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">reliable_traits</span></span>
<span><span class="co">#&gt; [1] "stomzone.area.median"           "stomatal.index"                </span></span>
<span><span class="co">#&gt; [3] "stomzone.undulation.amp.median" "pavezone.undulation.amp.median"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-many-cells-do-i-need-to-trace">How many cells do I need to trace?<a class="anchor" aria-label="anchor" href="#how-many-cells-do-i-need-to-trace"></a>
</h2>
<p>The limiting step in the <code>epidermalmorph</code> workflow is
undoubtedly the segmentation, or tracing of images, so it is useful to
know how many cells we need to measure to get a good estimate of the
traits for that individual or species.</p>
<p><code>epidermalmorph</code> provides a function to do this. By
repeatedly subsampling patches of cells (i.e. simulating tracing only a
portion of an image) then plotting how much the measured traits differ
from the groundtruth (the trait value measured from all cells in an
image). For more details, see Brown (2022).</p>
<p>This should be done for the same imageset that is used to evaluate
trait reliability, but for demonstration purposes, here we will only use
Image1.1 (from above).</p>
<p>Here, we repeat trait measurements using small patches of cells from
the image. As noted above, we do not include parallel execution in the
package but suggest that this step could be run in parallel for multiple
images:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_epidermal_traits.html">subsample_epidermal_traits</a></span><span class="op">(</span><span class="va">traits1.1</span>, n.runs <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                 k.cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">150</span>,<span class="fl">200</span>,<span class="fl">250</span>,<span class="fl">300</span>,<span class="fl">350</span>,<span class="fl">400</span><span class="op">)</span>, </span>
<span>                                 scaling <span class="op">=</span><span class="va">globalSDs</span>,</span>
<span>                                 trait.subset <span class="op">=</span> <span class="va">reliable_traits</span><span class="op">)</span></span></code></pre></div>
<p>If we were analysing multiple images, we would then bind the rows for
each image into one data.frame (we have kept these two functions
separate to facilitate parallel execution).</p>
<p>Then, we can evaluate how each trait measurement varies over
different sample sizes by plotting the standard deviation of sampled
measurements against the number of relevant cells (see Brown, 2022 for
details).</p>
<p>Points in the grey represent trait-sample combinations that are above
the user-defined threshold (here, 20% of the global variation)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsampling_summary.html">subsampling_summary</a></span><span class="op">(</span><span class="va">df</span>, traits<span class="op">=</span><span class="va">reliable_traits</span>, thresholdvalue <span class="op">=</span> <span class="fl">0.2</span>, number.of.bins <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">p</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span>,align <span class="op">=</span> <span class="st">"v"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values (geom_point).</span></span>
<span><span class="co">#&gt; Warning: Removed 4 row(s) containing missing values (geom_path).</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values (geom_point).</span></span>
<span><span class="co">#&gt; Warning: Removed 3 row(s) containing missing values (geom_path).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_point).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_point).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (geom_point).</span></span>
<span><span class="co">#&gt; Warning: Removed 2 row(s) containing missing values (geom_path).</span></span></code></pre></div>
<p><img src="introduction-to-epidermalmorph_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p>From these plots, we can see that, <em>for this image</em>:</p>
<ul>
<li>100 cells in total is sufficient for pavement cell traits to be
measured</li>
<li>50 pavement cells in total is sufficient for pavement cell traits
(from all zones)</li>
<li>30 stomata (or more) are required to measure stomatal index</li>
<li>For specific types of pavement cells (pavezone, stomzone), 20-40
cells are sufficient.</li>
</ul>
<p>We recommend that analyses of trait reliability and sampling effort
be done for any study that employs <code>epidermalmorph</code> to
provide evidence that trait measurements and cell sample sizes are
sufficient to reliably measure traits.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Brown, M.J.M. (2022). <em>Old plants, new tricks: machine learning
and the conifer fossil record</em>. (Doctoral dissertation, University
of Tasmania).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matilda Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
